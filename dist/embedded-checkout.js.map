{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"tslib\"","webpack:///./src/common/utility/bind-decorator.ts","webpack:///./src/embedded-checkout/iframe-content/embedded-content-events.ts","webpack:///./src/common/url/append-www.ts","webpack:///external \"iframe-resizer\"","webpack:///external \"iframe-resizer/js/iframeResizer.contentWindow\"","webpack:///./src/common/iframe/iframe-event-poster.ts","webpack:///./src/common/iframe/iframe-event-listener.ts","webpack:///./src/embedded-checkout/errors/not-embeddable-error.ts","webpack:///./src/embedded-checkout/errors/invalid-login-token-error.ts","webpack:///./src/embedded-checkout/embedded-checkout.ts","webpack:///./src/embedded-checkout/resizable-iframe-creator.ts","webpack:///./src/embedded-checkout/embed-checkout.ts","webpack:///./src/embedded-checkout/iframe-content/handle-frame-loaded-event.ts","webpack:///./src/common/error/errors/custom-error.ts","webpack:///./src/embedded-checkout/iframe-content/iframe-embedded-checkout-messenger.ts","webpack:///./src/embedded-checkout/iframe-content/noop-embedded-checkout-messenger.ts","webpack:///./src/embedded-checkout/iframe-content/create-embedded-checkout-messenger.ts","webpack:///./src/common/error/errors/standard-error.ts","webpack:///./src/common/utility/set-prototype-of.ts","webpack:///./src/common/loading-indicator/loading-indicator.ts","webpack:///./src/common/storage/browser-storage.ts","webpack:///./src/common/iframe/iframe-resizer.ts","webpack:///./src/bundles/embedded-checkout.ts","webpack:///external \"rxjs\"","webpack:///./src/embedded-checkout/embedded-checkout-events.ts","webpack:///./src/common/error/errors/request-error.ts","webpack:///external \"@bigcommerce/request-sender\"","webpack:///./src/common/error/errors/invalid-argument-error.ts","webpack:///./src/common/url/parse-url.ts","webpack:///external \"rxjs/operators\"","webpack:///./src/common/iframe/is-iframe-event.ts","webpack:///external \"local-storage-fallback\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","bindMethodDecorator","_","descriptor","method","boundMethod","this","set","target","decoratedTarget","getOwnPropertyNames","forEach","getOwnPropertyDescriptor","bindClassDecorator","EmbeddedContentEventType","appendWww","url","hostname","indexOf","href","replace","targetOrigin","_targetWindow","_targetOrigin","origin","post","event","options","targetWindow","window","Error","result","pipe","data","type","successType","errorType","toPromise","postMessage","setTarget","sourceOrigin","_sourceOrigins","_isListening","_listeners","listen","addEventListener","_handleMessage","stopListen","removeEventListener","addListener","listener","listeners","push","removeListener","index","splice","trigger","NotEmbeddableErrorType","response","message","body","title","subtype","UnknownError","_iframeCreator","_messageListener","_messagePoster","_loadingIndicator","_requestSender","_storage","_location","_options","_isAttached","onComplete","CheckoutComplete","onError","CheckoutError","onLoad","CheckoutLoaded","onFrameLoad","FrameLoaded","onSignOut","SignedOut","_configureStyles","attach","Promise","resolve","show","containerId","_allowCookie","then","_attemptLogin","createFrame","iframe","_iframe","hide","catch","error","_retryAllowCookie","FrameError","payload","detach","parentNode","removeChild","iFrameResizer","close","contentWindow","styles","StyleConfigured","test","pathname","reject","getItem","setItem","Date","now","redirectUrl","encodeURIComponent","document","style","visibility","lastAttempt","Number","MissingContent","removeItem","EmbeddedCheckout","src","container","getElementById","timeout","MissingContainer","createElement","border","display","width","allowPaymentRequest","appendChild","_toResizableFrame","timeoutInterval","setTimeout","handleMessage","teardown","contentId","iframes","scrolling","sizeWidth","heightCalculationMethod","length","clearTimeout","STORAGE_PREFIX","embedCheckout","loadingIndicator","location","handleFrameLoadedEvent","hasAttribute","setAttribute","isCustomError","_untargetedMessagePoster","_messageHandlers","postComplete","_postMessage","postError","_transformError","postFrameError","untargeted","postFrameLoaded","postLoaded","postSignedOut","receiveStyles","handler","_notifyMessageHandlers","keys","undefined","IframeEmbeddedCheckoutMessenger","NoopEmbeddedCheckoutMessenger","createEmbeddedCheckoutMessenger","parentWindow","parent","parentOrigin","setPrototypeOf","__proto__","captureStackTrace","stack","DEFAULT_STYLES","size","color","backgroundColor","ROTATION_ANIMATION","_styles","_defineAnimation","_container","_buildContainer","_indicator","_buildIndicator","parentId","opacity","handleTransitionEnd","bottom","left","height","position","right","top","transition","indicator","borderRadius","borderColor","margin","transform","transformStyle","animation","id","head","sheet","CSSStyleSheet","insertRule","_namespace","rawValue","withNamespace","JSON","parse","getItemOnce","stringify","iframeResizer","originalIframeResizer","setupContentWindowForIframeResizer","EmbeddedCheckoutEventType","DEFAULT_RESPONSE","headers","status","errors","parseUrl","anchor","port","hash","protocol","search","isIframeEvent"],"mappings":"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","file":"embedded-checkout.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 225);\n","module.exports = require(\"tslib\");","/**\r\n * Decorates a class or a method by binding all its prototype methods or itself\r\n * to the calling instance respectively.\r\n */\r\nfunction bindDecorator<T extends Method>(target: object, key: string, descriptor: TypedPropertyDescriptor<T>): TypedPropertyDescriptor<T>;\r\nfunction bindDecorator<T extends Constructor<object>>(target: T): T;\r\nfunction bindDecorator(target: any, key?: any, descriptor?: any): any {\r\n    if (!key || !descriptor) {\r\n        return bindClassDecorator(target);\r\n    }\r\n\r\n    return bindMethodDecorator(target, key, descriptor);\r\n}\r\n\r\nexport default bindDecorator;\r\n\r\n/**\r\n * Decorates a class by binding all its prototype methods to the calling\r\n * instance.\r\n */\r\nexport function bindClassDecorator<T extends Constructor<object>>(target: T): T {\r\n    const decoratedTarget = class extends target {};\r\n\r\n    Object.getOwnPropertyNames(target.prototype)\r\n        .forEach(key => {\r\n            const descriptor = Object.getOwnPropertyDescriptor(target.prototype, key);\r\n\r\n            if (!descriptor || key === 'constructor') {\r\n                return;\r\n            }\r\n\r\n            Object.defineProperty(\r\n                decoratedTarget.prototype,\r\n                key,\r\n                bindMethodDecorator(target.prototype, key, descriptor)\r\n            );\r\n        });\r\n\r\n    return decoratedTarget;\r\n}\r\n\r\n/**\r\n * Decorates a method by binding it to the calling instance.\r\n */\r\nexport function bindMethodDecorator<T extends Method>(_: object, key: string, descriptor: TypedPropertyDescriptor<T>): TypedPropertyDescriptor<T> {\r\n    if (typeof descriptor.value !== 'function') {\r\n        return descriptor;\r\n    }\r\n\r\n    let method: T = descriptor.value;\r\n\r\n    return {\r\n        get() {\r\n            const boundMethod = method.bind(this) as T;\r\n\r\n            Object.defineProperty(this, key, {\r\n                ...descriptor,\r\n                value: boundMethod,\r\n            });\r\n\r\n            return boundMethod;\r\n        },\r\n        set(value) {\r\n            method = value;\r\n        },\r\n    };\r\n}\r\n\r\nexport type Constructor<T> = new (...args: any[]) => T;\r\nexport type Method = (...args: any[]) => any;\r\n","import EmbeddedCheckoutStyles from '../embedded-checkout-styles';\r\n\r\nexport enum EmbeddedContentEventType {\r\n    StyleConfigured = 'STYLE_CONFIGURED',\r\n}\r\n\r\nexport interface EmbeddedContentEventMap {\r\n    [EmbeddedContentEventType.StyleConfigured]: EmbeddedContentStyleConfiguredEvent;\r\n}\r\n\r\nexport type EmbeddedContentEvent = (\r\n    EmbeddedContentStyleConfiguredEvent\r\n);\r\n\r\nexport interface EmbeddedContentStyleConfiguredEvent {\r\n    type: EmbeddedContentEventType.StyleConfigured;\r\n    payload: EmbeddedCheckoutStyles;\r\n}\r\n","import parseUrl from './parse-url';\r\nimport Url from './url';\r\n\r\nexport default function appendWww(url: Url): Url {\r\n    return parseUrl(\r\n        url.hostname.indexOf('www') === 0 ?\r\n            url.href :\r\n            url.href.replace(url.hostname, `www.${url.hostname}`)\r\n    );\r\n}\r\n","module.exports = require(\"iframe-resizer\");","module.exports = require(\"iframe-resizer/js/iframeResizer.contentWindow\");","import { fromEvent } from 'rxjs';\r\nimport { filter, map, take } from 'rxjs/operators';\r\n\r\nimport { parseUrl } from '../url';\r\n\r\nimport IframeEvent from './iframe-event';\r\nimport isIframeEvent from './is-iframe-event';\r\n\r\nexport interface IframeEventPostOptions<TSuccessEvent extends IframeEvent, TErrorEvent extends IframeEvent> {\r\n    errorType?: TErrorEvent['type'];\r\n    successType?: TSuccessEvent['type'];\r\n}\r\n\r\nexport default class IframeEventPoster<TEvent> {\r\n    private _targetOrigin: string;\r\n\r\n    constructor(\r\n        targetOrigin: string,\r\n        private _targetWindow?: Window\r\n    ) {\r\n        this._targetOrigin = targetOrigin === '*' ? '*' : parseUrl(targetOrigin).origin;\r\n    }\r\n\r\n    post(event: TEvent): void;\r\n    post<TSuccessEvent extends IframeEvent = IframeEvent, TErrorEvent extends IframeEvent = IframeEvent>(\r\n        event: TEvent,\r\n        options: IframeEventPostOptions<TSuccessEvent, TErrorEvent>\r\n    ): Promise<TSuccessEvent>;\r\n    post<TSuccessEvent extends IframeEvent = IframeEvent, TErrorEvent extends IframeEvent = IframeEvent>(\r\n        event: TEvent,\r\n        options?: IframeEventPostOptions<TSuccessEvent, TErrorEvent>\r\n    ): Promise<TSuccessEvent> | void {\r\n        const targetWindow = this._targetWindow;\r\n\r\n        if (window === targetWindow) {\r\n            return;\r\n        }\r\n\r\n        if (!targetWindow) {\r\n            throw new Error('Unable to post message because target window is not set.');\r\n        }\r\n\r\n        const result = options && fromEvent<MessageEvent>(window, 'message')\r\n            .pipe(\r\n                filter(event =>\r\n                    event.origin === this._targetOrigin &&\r\n                    isIframeEvent(event.data, event.data.type) &&\r\n                    [options.successType, options.errorType].indexOf(event.data.type) !== -1\r\n                ),\r\n                map(event => {\r\n                    if (options.errorType === event.data.type) {\r\n                        throw event.data;\r\n                    }\r\n\r\n                    return event.data;\r\n                }),\r\n                take(1)\r\n            )\r\n            .toPromise();\r\n\r\n        targetWindow.postMessage(event, this._targetOrigin);\r\n\r\n        return result;\r\n    }\r\n\r\n    setTarget(window: Window) {\r\n        this._targetWindow = window;\r\n    }\r\n}\r\n","import { appendWww, parseUrl } from '../url';\r\nimport { bindDecorator as bind } from '../utility';\r\n\r\nimport { IframeEventMap } from './iframe-event';\r\nimport isIframeEvent from './is-iframe-event';\r\n\r\nexport default class IframeEventListener<TEventMap extends IframeEventMap<keyof TEventMap>> {\r\n    private _isListening: boolean;\r\n    private _listeners: EventListeners<TEventMap>;\r\n    private _sourceOrigins: string[];\r\n\r\n    constructor(\r\n        sourceOrigin: string\r\n    ) {\r\n        this._sourceOrigins = [\r\n            parseUrl(sourceOrigin).origin,\r\n            appendWww(parseUrl(sourceOrigin)).origin,\r\n        ];\r\n        this._isListening = false;\r\n        this._listeners = {};\r\n    }\r\n\r\n    listen(): void {\r\n        if (this._isListening) {\r\n            return;\r\n        }\r\n\r\n        this._isListening = true;\r\n\r\n        window.addEventListener('message', this._handleMessage);\r\n    }\r\n\r\n    stopListen(): void {\r\n        if (!this._isListening) {\r\n            return;\r\n        }\r\n\r\n        this._isListening = false;\r\n\r\n        window.removeEventListener('message', this._handleMessage);\r\n    }\r\n\r\n    addListener<TType extends keyof TEventMap>(type: TType, listener: (event: TEventMap[TType]) => void): void {\r\n        let listeners = this._listeners[type];\r\n\r\n        if (!listeners) {\r\n            this._listeners[type] = listeners = [];\r\n        }\r\n\r\n        if (listeners.indexOf(listener) === -1) {\r\n            listeners.push(listener);\r\n        }\r\n    }\r\n\r\n    removeListener<TType extends keyof TEventMap>(type: TType, listener: (event: TEventMap[TType]) => void): void {\r\n        const listeners = this._listeners[type];\r\n\r\n        if (!listeners) {\r\n            return;\r\n        }\r\n\r\n        const index = listeners.indexOf(listener);\r\n\r\n        if (index >= 0) {\r\n            listeners.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    trigger<TType extends keyof TEventMap>(event: TEventMap[TType]): void {\r\n        const listeners = this._listeners[event.type];\r\n\r\n        if (!listeners) {\r\n            return;\r\n        }\r\n\r\n        listeners.forEach(listener => listener(event));\r\n    }\r\n\r\n    @bind\r\n    private _handleMessage(event: MessageEvent): void {\r\n        if ((this._sourceOrigins.indexOf(event.origin) === -1) ||\r\n            !isIframeEvent(event.data as TEventMap[keyof TEventMap], event.data.type)\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        this.trigger(event.data);\r\n    }\r\n}\r\n\r\ntype EventListeners<TEventMap> = {\r\n    [key in keyof TEventMap]?: Array<(event: TEventMap[key]) => void>;\r\n};\r\n","import { StandardError } from '../../common/error/errors';\r\n\r\nexport enum NotEmbeddableErrorType {\r\n    MissingContainer = 'missing_container',\r\n    MissingContent = 'missing_content',\r\n    UnknownError = 'unknown_error',\r\n}\r\n\r\n/**\r\n * Throw this error if we are not able to embed the checkout form as an iframe.\r\n * This can be due to the fact that the provided container ID is invalid, or the\r\n * checkout form fails to load inside the iframe. It can also be due to an\r\n * unknown reason.\r\n */\r\nexport default class NotEmbeddableError extends StandardError {\r\n    constructor(\r\n        message?: string,\r\n        public subtype: NotEmbeddableErrorType = NotEmbeddableErrorType.UnknownError\r\n    ) {\r\n        super(message || 'Unable to embed the checkout form.');\r\n\r\n        this.name = 'NotEmbeddableError';\r\n        this.type = 'not_embeddable';\r\n    }\r\n}\r\n","import { Response } from '@bigcommerce/request-sender';\r\n\r\nimport { InternalErrorResponseBody } from '../../common/error';\r\nimport { RequestError } from '../../common/error/errors';\r\n\r\n/**\r\n * Throw this error we are not able to sign in a shopper because the provided\r\n * login token is invalid.\r\n */\r\nexport default class InvalidLoginTokenError extends RequestError {\r\n    constructor(response: Response<InternalErrorResponseBody>) {\r\n        super(response, { message: response.body.title });\r\n\r\n        this.name = 'InvalidLoginTokenError';\r\n        this.type = 'invalid_login_token';\r\n    }\r\n}\r\n","import { RequestSender } from '@bigcommerce/request-sender';\r\n\r\nimport { IframeEventListener, IframeEventPoster, IFrameComponent } from '../common/iframe';\r\nimport { LoadingIndicator } from '../common/loading-indicator';\r\nimport { BrowserStorage } from '../common/storage';\r\nimport { parseUrl } from '../common/url';\r\nimport { bindDecorator as bind } from '../common/utility';\r\n\r\nimport EmbeddedCheckoutError from './embedded-checkout-error';\r\nimport { EmbeddedCheckoutEventMap, EmbeddedCheckoutEventType } from './embedded-checkout-events';\r\nimport EmbeddedCheckoutOptions from './embedded-checkout-options';\r\nimport { InvalidLoginTokenError, NotEmbeddableError, NotEmbeddableErrorType } from './errors';\r\nimport { EmbeddedContentEvent, EmbeddedContentEventType } from './iframe-content';\r\nimport ResizableIframeCreator from './resizable-iframe-creator';\r\n\r\nexport const ALLOW_COOKIE_ATTEMPT_INTERVAL = 10 * 60 * 1000;\r\nexport const IS_COOKIE_ALLOWED_KEY = 'isCookieAllowed';\r\nexport const LAST_ALLOW_COOKIE_ATTEMPT_KEY = 'lastAllowCookieAttempt';\r\n\r\n@bind\r\nexport default class EmbeddedCheckout {\r\n    private _iframe?: IFrameComponent;\r\n    private _isAttached: boolean;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    constructor(\r\n        private _iframeCreator: ResizableIframeCreator,\r\n        private _messageListener: IframeEventListener<EmbeddedCheckoutEventMap>,\r\n        private _messagePoster: IframeEventPoster<EmbeddedContentEvent>,\r\n        private _loadingIndicator: LoadingIndicator,\r\n        private _requestSender: RequestSender,\r\n        private _storage: BrowserStorage,\r\n        private _location: Location,\r\n        private _options: EmbeddedCheckoutOptions\r\n    ) {\r\n        this._isAttached = false;\r\n\r\n        if (this._options.onComplete) {\r\n            this._messageListener.addListener(EmbeddedCheckoutEventType.CheckoutComplete, this._options.onComplete);\r\n        }\r\n\r\n        if (this._options.onError) {\r\n            this._messageListener.addListener(EmbeddedCheckoutEventType.CheckoutError, this._options.onError);\r\n        }\r\n\r\n        if (this._options.onLoad) {\r\n            this._messageListener.addListener(EmbeddedCheckoutEventType.CheckoutLoaded, this._options.onLoad);\r\n        }\r\n\r\n        if (this._options.onFrameLoad) {\r\n            this._messageListener.addListener(EmbeddedCheckoutEventType.FrameLoaded, this._options.onFrameLoad);\r\n        }\r\n\r\n        if (this._options.onSignOut) {\r\n            this._messageListener.addListener(EmbeddedCheckoutEventType.SignedOut, this._options.onSignOut);\r\n        }\r\n\r\n        this._messageListener.addListener(EmbeddedCheckoutEventType.FrameLoaded, () => this._configureStyles());\r\n    }\r\n\r\n    attach(): Promise<this> {\r\n        if (this._isAttached) {\r\n            return Promise.resolve(this);\r\n        }\r\n\r\n        this._isAttached = true;\r\n        this._messageListener.listen();\r\n        this._loadingIndicator.show(this._options.containerId);\r\n\r\n        return this._allowCookie()\r\n            .then(() => this._attemptLogin())\r\n            .then(url => this._iframeCreator.createFrame(url, this._options.containerId))\r\n            .then(iframe => {\r\n                this._iframe = iframe;\r\n\r\n                this._configureStyles();\r\n                this._loadingIndicator.hide();\r\n            })\r\n            .catch(error => {\r\n                this._isAttached = false;\r\n\r\n                return this._retryAllowCookie(error)\r\n                    .catch(() => {\r\n                        this._messageListener.trigger({\r\n                            type: EmbeddedCheckoutEventType.FrameError,\r\n                            payload: error,\r\n                        });\r\n\r\n                        this._loadingIndicator.hide();\r\n\r\n                        throw error;\r\n                    });\r\n            })\r\n            .then(() => this);\r\n    }\r\n\r\n    detach(): void {\r\n        if (!this._isAttached) {\r\n            return;\r\n        }\r\n\r\n        this._isAttached = false;\r\n        this._messageListener.stopListen();\r\n\r\n        if (this._iframe && this._iframe.parentNode) {\r\n            this._iframe.parentNode.removeChild(this._iframe);\r\n            this._iframe.iFrameResizer.close();\r\n        }\r\n    }\r\n\r\n    private _configureStyles(): void {\r\n        if (!this._iframe || !this._iframe.contentWindow || !this._options.styles) {\r\n            return;\r\n        }\r\n\r\n        this._messagePoster.setTarget(this._iframe.contentWindow);\r\n\r\n        this._messagePoster.post({\r\n            type: EmbeddedContentEventType.StyleConfigured,\r\n            payload: this._options.styles,\r\n        });\r\n    }\r\n\r\n    private _attemptLogin(): Promise<string> {\r\n        if (!/^\\/login\\/token/.test(parseUrl(this._options.url).pathname)) {\r\n            return Promise.resolve(this._options.url);\r\n        }\r\n\r\n        return this._requestSender.post<{ redirectUrl: string }>(this._options.url)\r\n            .then(({ body: { redirectUrl } }) => redirectUrl)\r\n            .catch(response => Promise.reject(new InvalidLoginTokenError(response)));\r\n    }\r\n\r\n    /**\r\n     * This workaround is required for certain browsers (namely Safari) that\r\n     * prevent session cookies to be set for a third party website unless the\r\n     * user has recently visited such website. Therefore, before we attempt to\r\n     * login or set an active cart in the session, we need to first redirect the\r\n     * user to the domain of Embedded Checkout.\r\n     */\r\n    private _allowCookie(): Promise<void> {\r\n        if (this._storage.getItem(IS_COOKIE_ALLOWED_KEY)) {\r\n            return Promise.resolve();\r\n        }\r\n\r\n        this._storage.setItem(IS_COOKIE_ALLOWED_KEY, true);\r\n\r\n        // It could be possible that the flag is set to true but the browser has\r\n        // already removed the permission to store third-party cookies. In that\r\n        // case, we should try to redirect the user again. But we only want to\r\n        // do it once within a fixed interval. This is to avoid getting into a\r\n        // redirect loop if the shopper actually doesn't have a valid card\r\n        // session.\r\n        this._storage.setItem(LAST_ALLOW_COOKIE_ATTEMPT_KEY, Date.now());\r\n\r\n        const { origin } = parseUrl(this._options.url);\r\n        const redirectUrl = `${origin}/embedded-checkout/allow-cookie?returnUrl=${encodeURIComponent(this._location.href)}`;\r\n\r\n        document.body.style.visibility = 'hidden';\r\n        this._location.replace(redirectUrl);\r\n\r\n        return new Promise<never>(() => {});\r\n    }\r\n\r\n    private _retryAllowCookie(error: EmbeddedCheckoutError): Promise<void> {\r\n        const lastAttempt = Number(this._storage.getItem(LAST_ALLOW_COOKIE_ATTEMPT_KEY));\r\n        const canRetry = (\r\n            (!lastAttempt || Date.now() - lastAttempt > ALLOW_COOKIE_ATTEMPT_INTERVAL) &&\r\n            error instanceof NotEmbeddableError &&\r\n            error.subtype === NotEmbeddableErrorType.MissingContent\r\n        );\r\n\r\n        if (!canRetry) {\r\n            return Promise.reject();\r\n        }\r\n\r\n        this._storage.removeItem(LAST_ALLOW_COOKIE_ATTEMPT_KEY);\r\n        this._storage.removeItem(IS_COOKIE_ALLOWED_KEY);\r\n\r\n        return this._allowCookie();\r\n    }\r\n}\r\n","import { iframeResizer, isIframeEvent, IFrameComponent } from '../common/iframe';\r\nimport { parseUrl } from '../common/url';\r\n\r\nimport { EmbeddedCheckoutEventType } from './embedded-checkout-events';\r\nimport { NotEmbeddableError, NotEmbeddableErrorType } from './errors';\r\n\r\nexport default class ResizableIframeCreator {\r\n    constructor(\r\n        private _options?: { timeout: number }\r\n    ) {}\r\n\r\n    createFrame(src: string, containerId: string): Promise<IFrameComponent> {\r\n        const container = document.getElementById(containerId);\r\n        const { timeout = 60000 } = this._options || {};\r\n\r\n        if (!container) {\r\n            throw new NotEmbeddableError(\r\n                'Unable to embed the iframe because the container element could not be found.',\r\n                NotEmbeddableErrorType.MissingContainer\r\n            );\r\n        }\r\n\r\n        const iframe = document.createElement('iframe');\r\n\r\n        iframe.src = src;\r\n        iframe.style.border = 'none';\r\n        iframe.style.display = 'none';\r\n        iframe.style.width = '100%';\r\n        iframe.allowPaymentRequest = true;\r\n\r\n        container.appendChild(iframe);\r\n\r\n        return this._toResizableFrame(iframe, timeout)\r\n            .catch(error => {\r\n                container.removeChild(iframe);\r\n\r\n                throw error;\r\n            });\r\n    }\r\n\r\n    private _toResizableFrame(iframe: HTMLIFrameElement, timeoutInterval: number): Promise<IFrameComponent> {\r\n        // Can't simply listen to `load` event because it always gets triggered even if there's an error.\r\n        // Instead, listen to the `load` inside the iframe and let the parent frame know when it happens.\r\n        return new Promise((resolve, reject) => {\r\n            const timeout = window.setTimeout(() => {\r\n                reject(new NotEmbeddableError('Unable to embed the iframe because the content could not be loaded.'));\r\n            }, timeoutInterval);\r\n\r\n            const handleMessage = (event: MessageEvent) => {\r\n                if (event.origin !== parseUrl(iframe.src).origin) {\r\n                    return;\r\n                }\r\n\r\n                if (isIframeEvent(event.data, EmbeddedCheckoutEventType.FrameError)) {\r\n                    teardown();\r\n                    reject(new NotEmbeddableError(event.data.payload.message, NotEmbeddableErrorType.MissingContent));\r\n                }\r\n\r\n                if (isIframeEvent(event.data, EmbeddedCheckoutEventType.FrameLoaded)) {\r\n                    iframe.style.display = '';\r\n\r\n                    const contentId = event.data.payload && event.data.payload.contentId;\r\n                    const iframes = iframeResizer({\r\n                        scrolling: false,\r\n                        sizeWidth: false,\r\n                        heightCalculationMethod: contentId ? 'taggedElement' : 'lowestElement',\r\n                    }, iframe);\r\n\r\n                    teardown();\r\n                    resolve(iframes[iframes.length - 1]);\r\n                }\r\n            };\r\n\r\n            const teardown = () => {\r\n                window.removeEventListener('message', handleMessage);\r\n                window.clearTimeout(timeout);\r\n            };\r\n\r\n            window.addEventListener('message', handleMessage);\r\n        });\r\n    }\r\n}\r\n","import { createRequestSender } from '@bigcommerce/request-sender';\r\n\r\nimport { IframeEventListener, IframeEventPoster } from '../common/iframe';\r\nimport { LoadingIndicator } from '../common/loading-indicator';\r\nimport { BrowserStorage } from '../common/storage';\r\nimport { parseUrl } from '../common/url';\r\n\r\nimport EmbeddedCheckout from './embedded-checkout';\r\nimport { EmbeddedCheckoutEventMap } from './embedded-checkout-events';\r\nimport EmbeddedCheckoutOptions from './embedded-checkout-options';\r\nimport { EmbeddedContentEvent } from './iframe-content';\r\nimport ResizableIframeCreator from './resizable-iframe-creator';\r\n\r\nconst STORAGE_PREFIX = 'BigCommerce.EmbeddedCheckout';\r\n\r\n/**\r\n * Embed the checkout form in an iframe.\r\n *\r\n * @remarks\r\n * Once the iframe is embedded, it will automatically resize according to the\r\n * size of the checkout form. It will also notify the parent window when certain\r\n * events have occurred. i.e.: when the form is loaded and ready to be used.\r\n *\r\n * ```js\r\n * embedCheckout({\r\n *     url: 'https://checkout/url',\r\n *     containerId: 'container-id',\r\n * });\r\n * ```\r\n *\r\n * @param options - Options for embedding the checkout form.\r\n * @returns A promise that resolves to an instance of `EmbeddedCheckout`.\r\n */\r\nexport default function embedCheckout(options: EmbeddedCheckoutOptions): Promise<EmbeddedCheckout> {\r\n    const origin = parseUrl(options.url).origin;\r\n    const embeddedCheckout = new EmbeddedCheckout(\r\n        new ResizableIframeCreator(),\r\n        new IframeEventListener<EmbeddedCheckoutEventMap>(origin),\r\n        new IframeEventPoster<EmbeddedContentEvent>(origin),\r\n        new LoadingIndicator({ styles: options.styles && options.styles.loadingIndicator }),\r\n        createRequestSender(),\r\n        new BrowserStorage(STORAGE_PREFIX),\r\n        window.location,\r\n        options\r\n    );\r\n\r\n    return embeddedCheckout.attach();\r\n}\r\n","import { EmbeddedCheckoutFrameLoadedEvent } from '../embedded-checkout-events';\r\n\r\nexport default function handleFrameLoadedEvent(message: EmbeddedCheckoutFrameLoadedEvent): void {\r\n    if (!message.payload || !message.payload.contentId) {\r\n        return;\r\n    }\r\n\r\n    const body = document.getElementById(message.payload.contentId);\r\n\r\n    if (!body || body.hasAttribute('data-iframe-height')) {\r\n        return;\r\n    }\r\n\r\n    body.setAttribute('data-iframe-height', '');\r\n}\r\n","export default interface CustomError extends Error {\r\n    message: string;\r\n    type: string;\r\n    subtype?: string;\r\n}\r\n\r\nexport function isCustomError(error: any): error is CustomError {\r\n    return (\r\n        typeof error.message === 'string' &&\r\n        typeof error.type === 'string' &&\r\n        (typeof error.subtype === 'string' || !error.subtype) &&\r\n        error instanceof Error\r\n    );\r\n}\r\n","import { isCustomError, CustomError } from '../../common/error/errors';\r\nimport { IframeEventListener, IframeEventPoster } from '../../common/iframe';\r\nimport { bindDecorator as bind } from '../../common/utility';\r\nimport EmbeddedCheckoutError from '../embedded-checkout-error';\r\nimport { EmbeddedCheckoutCompleteEvent, EmbeddedCheckoutErrorEvent, EmbeddedCheckoutEvent, EmbeddedCheckoutEventMap, EmbeddedCheckoutEventType, EmbeddedCheckoutFrameErrorEvent, EmbeddedCheckoutFrameLoadedEvent, EmbeddedCheckoutLoadedEvent, EmbeddedCheckoutSignedOutEvent } from '../embedded-checkout-events';\r\nimport EmbeddedCheckoutStyles from '../embedded-checkout-styles';\r\n\r\nimport EmbeddedCheckoutMessenger from './embedded-checkout-messenger';\r\nimport { EmbeddedContentEventMap, EmbeddedContentEventType } from './embedded-content-events';\r\nimport EmbeddedContentOptions from './embedded-content-options';\r\n\r\n@bind\r\nexport default class IframeEmbeddedCheckoutMessenger implements EmbeddedCheckoutMessenger {\r\n    /**\r\n     * @internal\r\n     */\r\n    constructor(\r\n        private _messageListener: IframeEventListener<EmbeddedContentEventMap>,\r\n        private _messagePoster: IframeEventPoster<EmbeddedCheckoutEvent>,\r\n        private _untargetedMessagePoster: IframeEventPoster<EmbeddedCheckoutEvent>,\r\n        private _messageHandlers: EventCallbacks<EmbeddedCheckoutEventMap> = {}\r\n    ) {\r\n        this._messageListener.listen();\r\n    }\r\n\r\n    postComplete(): void {\r\n        const message: EmbeddedCheckoutCompleteEvent = {\r\n            type: EmbeddedCheckoutEventType.CheckoutComplete,\r\n        };\r\n\r\n        this._postMessage(message);\r\n    }\r\n\r\n    postError(payload: Error | CustomError): void {\r\n        const message: EmbeddedCheckoutErrorEvent = {\r\n            type: EmbeddedCheckoutEventType.CheckoutError,\r\n            payload: this._transformError(payload),\r\n        };\r\n\r\n        this._postMessage(message);\r\n    }\r\n\r\n    postFrameError(payload: Error | CustomError): void {\r\n        const message: EmbeddedCheckoutFrameErrorEvent = {\r\n            type: EmbeddedCheckoutEventType.FrameError,\r\n            payload: this._transformError(payload),\r\n        };\r\n\r\n        // Ideally, all messages should be targeted at a specific origin.\r\n        // However, for `FrameError` message, we have to post it in an\r\n        // untargeted fashion. This is because the error could be caused by a\r\n        // missing cart. That makes it not possible to determine of site origin\r\n        // of the parent window. Nevertheless, we still want to notify the\r\n        // parent window about the error.\r\n        this._postMessage(message, { untargeted: true });\r\n    }\r\n\r\n    postFrameLoaded(payload?: EmbeddedContentOptions): void {\r\n        const message: EmbeddedCheckoutFrameLoadedEvent = {\r\n            type: EmbeddedCheckoutEventType.FrameLoaded,\r\n            payload,\r\n        };\r\n\r\n        this._postMessage(message);\r\n    }\r\n\r\n    postLoaded(): void {\r\n        const message: EmbeddedCheckoutLoadedEvent = {\r\n            type: EmbeddedCheckoutEventType.CheckoutLoaded,\r\n        };\r\n\r\n        this._postMessage(message);\r\n    }\r\n\r\n    postSignedOut(): void {\r\n        const message: EmbeddedCheckoutSignedOutEvent = {\r\n            type: EmbeddedCheckoutEventType.SignedOut,\r\n        };\r\n\r\n        this._postMessage(message);\r\n    }\r\n\r\n    receiveStyles(handler: (styles: EmbeddedCheckoutStyles) => void): void {\r\n        this._messageListener.addListener(EmbeddedContentEventType.StyleConfigured, ({ payload }) => {\r\n            handler(payload);\r\n        });\r\n    }\r\n\r\n    private _postMessage(message: EmbeddedCheckoutEvent, options?: { untargeted?: boolean }): void {\r\n        this._notifyMessageHandlers(message);\r\n\r\n        if (options && options.untargeted) {\r\n            return this._untargetedMessagePoster.post(message);\r\n        }\r\n\r\n        this._messagePoster.post(message);\r\n    }\r\n\r\n    private _notifyMessageHandlers(message: EmbeddedCheckoutEvent): void {\r\n        Object.keys(this._messageHandlers)\r\n            .forEach(key => {\r\n                if (message.type !== key) {\r\n                    return;\r\n                }\r\n\r\n                const handler = this._messageHandlers[key];\r\n\r\n                if (handler) {\r\n                    (handler as (event: EmbeddedCheckoutEvent) => void).call(null, message);\r\n                }\r\n            });\r\n    }\r\n\r\n    private _transformError(error: Error | CustomError): EmbeddedCheckoutError {\r\n        return {\r\n            message: error.message,\r\n            type: isCustomError(error) ? error.type : undefined,\r\n            subtype: isCustomError(error) ? error.subtype : undefined,\r\n        };\r\n    }\r\n}\r\n\r\nexport type EventCallbacks<TEventMap> = {\r\n    [key in keyof TEventMap]?: (event: TEventMap[key]) => void;\r\n};\r\n","import { bindDecorator as bind } from '../../common/utility';\r\n\r\nimport EmbeddedCheckoutMessenger from './embedded-checkout-messenger';\r\n\r\n@bind\r\nexport default class NoopEmbeddedCheckoutMessenger implements EmbeddedCheckoutMessenger {\r\n    postComplete(): void {}\r\n\r\n    postError(): void {}\r\n\r\n    postFrameError(): void {}\r\n\r\n    postFrameLoaded(): void {}\r\n\r\n    postLoaded(): void {}\r\n\r\n    postSignedOut(): void {}\r\n\r\n    receiveStyles(): void {}\r\n}\r\n","import { setupContentWindowForIframeResizer, IframeEventListener, IframeEventPoster } from '../../common/iframe';\r\nimport { EmbeddedCheckoutEvent, EmbeddedCheckoutEventType } from '../embedded-checkout-events';\r\n\r\nimport EmbeddedCheckoutMessenger from './embedded-checkout-messenger';\r\nimport EmbeddedCheckoutMessengerOptions from './embedded-checkout-messenger-options';\r\nimport { EmbeddedContentEventMap } from './embedded-content-events';\r\nimport handleFrameLoadedEvent from './handle-frame-loaded-event';\r\nimport IframeEmbeddedCheckoutMessenger from './iframe-embedded-checkout-messenger';\r\nimport NoopEmbeddedCheckoutMessenger from './noop-embedded-checkout-messenger';\r\n\r\n/**\r\n * Create an instance of `EmbeddedCheckoutMessenger`.\r\n *\r\n * @remarks\r\n * The object is responsible for posting messages to the parent window from the\r\n * iframe when certain events have occurred. For example, when the checkout\r\n * form is first loaded, you should notify the parent window about it.\r\n *\r\n * The iframe can only be embedded in domains that are allowed by the store.\r\n *\r\n * ```ts\r\n * const messenger = createEmbeddedCheckoutMessenger({\r\n *     parentOrigin: 'https://some/website',\r\n * });\r\n *\r\n * messenger.postFrameLoaded();\r\n * ```\r\n *\r\n * @alpha\r\n * Please note that this feature is currently in an early stage of development.\r\n * Therefore the API is unstable and not ready for public consumption.\r\n *\r\n * @param options - Options for creating `EmbeddedCheckoutMessenger`\r\n * @returns - An instance of `EmbeddedCheckoutMessenger`\r\n */\r\nexport default function createEmbeddedCheckoutMessenger(options: EmbeddedCheckoutMessengerOptions): EmbeddedCheckoutMessenger {\r\n    setupContentWindowForIframeResizer();\r\n\r\n    const parentWindow = options.parentWindow || window.parent;\r\n\r\n    // Return a No-op messenger if it is not called inside an iframe\r\n    if (window === parentWindow) {\r\n        return new NoopEmbeddedCheckoutMessenger();\r\n    }\r\n\r\n    return new IframeEmbeddedCheckoutMessenger(\r\n        new IframeEventListener<EmbeddedContentEventMap>(options.parentOrigin),\r\n        new IframeEventPoster<EmbeddedCheckoutEvent>(options.parentOrigin, parentWindow),\r\n        new IframeEventPoster<EmbeddedCheckoutEvent>('*', parentWindow),\r\n        { [EmbeddedCheckoutEventType.FrameLoaded]: handleFrameLoadedEvent }\r\n    );\r\n}\r\n","import { setPrototypeOf } from '../../utility';\r\n\r\nimport CustomError from './custom-error';\r\n\r\n/**\r\n * This error type should not be constructed directly. It is a base class for\r\n * all custom errors thrown in this library.\r\n */\r\nexport default abstract class StandardError extends Error implements CustomError {\r\n    name = 'StandardError';\r\n    type = 'standard';\r\n\r\n    constructor(message?: string) {\r\n        super(message || 'An unexpected error has occurred.');\r\n\r\n        setPrototypeOf(this, new.target.prototype);\r\n\r\n        if (typeof Error.captureStackTrace === 'function') {\r\n            Error.captureStackTrace(this, new.target);\r\n        } else {\r\n            this.stack = (new Error(this.message)).stack;\r\n        }\r\n    }\r\n}\r\n","export default function setPrototypeOf(object: any, prototype: object) {\r\n    if (Object.setPrototypeOf) {\r\n        Object.setPrototypeOf(object, prototype);\r\n    } else {\r\n        object.__proto__ = prototype;\r\n    }\r\n\r\n    return object;\r\n}\r\n","import { LoadingIndicatorStyles } from './loading-indicator-styles';\r\n\r\nconst DEFAULT_STYLES: LoadingIndicatorStyles = {\r\n    size: 70,\r\n    color: '#d9d9d9',\r\n    backgroundColor: '#ffffff',\r\n};\r\n\r\nconst ROTATION_ANIMATION = 'embedded-checkout-loading-indicator-rotation';\r\n\r\nexport default class LoadingIndicator {\r\n    private _container: HTMLElement;\r\n    private _indicator: HTMLElement;\r\n    private _styles: LoadingIndicatorStyles;\r\n\r\n    constructor(\r\n        options?: { styles?: LoadingIndicatorStyles }\r\n    ) {\r\n        this._styles = { ...DEFAULT_STYLES, ...options && options.styles };\r\n\r\n        this._defineAnimation();\r\n\r\n        this._container = this._buildContainer();\r\n        this._indicator = this._buildIndicator();\r\n\r\n        this._container.appendChild(this._indicator);\r\n    }\r\n\r\n    show(parentId?: string): void {\r\n        if (parentId) {\r\n            const parent = document.getElementById(parentId);\r\n\r\n            if (!parent) {\r\n                throw new Error('Unable to attach the loading indicator because the parent ID is not valid.');\r\n            }\r\n\r\n            parent.appendChild(this._container);\r\n        }\r\n\r\n        this._container.style.visibility = 'visible';\r\n        this._container.style.opacity = '1';\r\n    }\r\n\r\n    hide(): void {\r\n        const handleTransitionEnd = () => {\r\n            this._container.style.visibility = 'hidden';\r\n\r\n            this._container.removeEventListener('transitionend', handleTransitionEnd);\r\n        };\r\n\r\n        this._container.addEventListener('transitionend', handleTransitionEnd);\r\n\r\n        this._container.style.opacity = '0';\r\n    }\r\n\r\n    private _buildContainer(): HTMLElement {\r\n        const container = document.createElement('div');\r\n\r\n        container.style.display = 'block';\r\n        container.style.bottom = '0';\r\n        container.style.left = '0';\r\n        container.style.height = '100%';\r\n        container.style.width = '100%';\r\n        container.style.position = 'absolute';\r\n        container.style.right = '0';\r\n        container.style.top = '0';\r\n        container.style.transition = 'all 250ms ease-out';\r\n        container.style.opacity = '0';\r\n\r\n        return container;\r\n    }\r\n\r\n    private _buildIndicator(): HTMLElement {\r\n        const indicator = document.createElement('div');\r\n\r\n        indicator.style.display = 'block';\r\n        indicator.style.width = `${this._styles.size}px`;\r\n        indicator.style.height = `${this._styles.size}px`;\r\n        indicator.style.borderRadius = `${this._styles.size}px`;\r\n        indicator.style.border = 'solid 1px';\r\n        indicator.style.borderColor = `${this._styles.backgroundColor} ${this._styles.backgroundColor} ${this._styles.color} ${this._styles.color}`;\r\n        indicator.style.margin = '0 auto';\r\n        indicator.style.position = 'absolute';\r\n        indicator.style.left = '0';\r\n        indicator.style.right = '0';\r\n        indicator.style.top = '50%';\r\n        indicator.style.transform = 'translateY(-50%) rotate(0deg)';\r\n        indicator.style.transformStyle = 'preserve-3d';\r\n        indicator.style.animation = `${ROTATION_ANIMATION} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`;\r\n\r\n        return indicator;\r\n    }\r\n\r\n    private _defineAnimation(): void {\r\n        // In order to define CSS animation, we need to insert a stylesheet into the host frame.\r\n        // We only have to do it once.\r\n        if (document.getElementById(ROTATION_ANIMATION)) {\r\n            return;\r\n        }\r\n\r\n        const style = document.createElement('style');\r\n\r\n        style.id = ROTATION_ANIMATION;\r\n\r\n        document.head.appendChild(style);\r\n\r\n        if (style.sheet instanceof CSSStyleSheet) {\r\n            // We need to provide the 2nd parameter for IE11, even though it is\r\n            // 0 by default for all other browsers.\r\n            style.sheet.insertRule(`\r\n                @keyframes ${ROTATION_ANIMATION} {\r\n                    0% { transform: translateY(-50%) rotate(0deg); }\r\n                    100% { transform: translateY(-50%) rotate(360deg); }\r\n                }\r\n            `, 0);\r\n        }\r\n    }\r\n}\r\n","import { default as storage } from 'local-storage-fallback';\r\n\r\nexport default class BrowserStorage {\r\n    constructor(\r\n        private _namespace: string\r\n    ) {}\r\n\r\n    getItem<TValue = any>(key: string): TValue | null {\r\n        const rawValue = storage.getItem(this.withNamespace(key));\r\n\r\n        if (rawValue === null) {\r\n            return null;\r\n        }\r\n\r\n        try {\r\n            return JSON.parse(rawValue);\r\n        } catch (error) {\r\n            // Clean up invalid values\r\n            this.removeItem(this.withNamespace(key));\r\n\r\n            return null;\r\n        }\r\n    }\r\n\r\n    getItemOnce<TValue = any>(key: string): TValue | null {\r\n        const value = this.getItem(key);\r\n\r\n        this.removeItem(key);\r\n\r\n        return value;\r\n    }\r\n\r\n    setItem<TValue = any>(key: string, value: TValue): void {\r\n        return storage.setItem(this.withNamespace(key), JSON.stringify(value));\r\n    }\r\n\r\n    removeItem(key: string): void {\r\n        return storage.removeItem(this.withNamespace(key));\r\n    }\r\n\r\n    private withNamespace(key: string): string {\r\n        return `${this._namespace}.${key}`;\r\n    }\r\n}\r\n","import { IFrameComponent, IFrameOptions } from 'iframe-resizer';\r\n\r\nexport {\r\n    HeightCalculationMethod,\r\n    IFrameComponent,\r\n    IFrameMessageData,\r\n    IFrameObject,\r\n    IFrameOptions,\r\n    IFramePage,\r\n    IFramePageOptions,\r\n    IFrameResizedData,\r\n    IFrameScrollData,\r\n    PageInfo,\r\n    WidthCalculationMethod,\r\n} from 'iframe-resizer';\r\n\r\n// The reason why we are wrapping the original `iframeResizer` function imported\r\n// from the package is because the package sets up event listeners (window\r\n// resize etc...) as soon as the package is imported. Therefore, to defer the\r\n// side effect from happening until the function is actually being used, we are\r\n// importing the package inside this function. To minimise the chance of\r\n// importing the original package inadvertently, we are also re-exporting all of\r\n// its public interfaces. The re-exports do not cause any side effect because\r\n// they are plain TypeScript interfaces; meaning they are only used for type\r\n// checks rather than for code output.\r\nexport function iframeResizer(options: IFrameOptions, target: string | HTMLElement): IFrameComponent[] {\r\n    const { iframeResizer: originalIframeResizer } = require('iframe-resizer');\r\n\r\n    return originalIframeResizer(options, target);\r\n}\r\n\r\n// We also need to wrap the original `iframeResizer.contentWindow` because\r\n// similarly the package sets up event listeners as soon as the package gets\r\n// imported. Another reason is that if it is imported at the top level using a\r\n// regular import statement, it will be stripped out by Webpack as it is\r\n// considered as \"unused\", unless we explicitly mark it as a package that\r\n// produces side effects.\r\nexport function setupContentWindowForIframeResizer(): void {\r\n    /* eslint-disable-next-line import/no-internal-modules */\r\n    require('iframe-resizer/js/iframeResizer.contentWindow');\r\n}\r\n","export { embedCheckout } from '../embedded-checkout';\r\nexport { createEmbeddedCheckoutMessenger } from '../embedded-checkout/iframe-content';\r\n","module.exports = require(\"rxjs\");","import EmbeddedCheckoutError from './embedded-checkout-error';\r\nimport { EmbeddedContentOptions } from './iframe-content';\r\n\r\nexport enum EmbeddedCheckoutEventType {\r\n    CheckoutComplete = 'CHECKOUT_COMPLETE',\r\n    CheckoutError = 'CHECKOUT_ERROR',\r\n    CheckoutLoaded = 'CHECKOUT_LOADED',\r\n    FrameError = 'FRAME_ERROR',\r\n    FrameLoaded = 'FRAME_LOADED',\r\n    SignedOut = 'SIGNED_OUT',\r\n}\r\n\r\nexport interface EmbeddedCheckoutEventMap {\r\n    [EmbeddedCheckoutEventType.CheckoutComplete]: EmbeddedCheckoutCompleteEvent;\r\n    [EmbeddedCheckoutEventType.CheckoutError]: EmbeddedCheckoutErrorEvent;\r\n    [EmbeddedCheckoutEventType.CheckoutLoaded]: EmbeddedCheckoutLoadedEvent;\r\n    [EmbeddedCheckoutEventType.FrameError]: EmbeddedCheckoutFrameErrorEvent;\r\n    [EmbeddedCheckoutEventType.FrameLoaded]: EmbeddedCheckoutFrameLoadedEvent;\r\n    [EmbeddedCheckoutEventType.SignedOut]: EmbeddedCheckoutSignedOutEvent;\r\n}\r\n\r\nexport type EmbeddedCheckoutEvent = (\r\n    EmbeddedCheckoutCompleteEvent |\r\n    EmbeddedCheckoutErrorEvent |\r\n    EmbeddedCheckoutFrameErrorEvent |\r\n    EmbeddedCheckoutFrameLoadedEvent |\r\n    EmbeddedCheckoutLoadedEvent |\r\n    EmbeddedCheckoutSignedOutEvent\r\n);\r\n\r\nexport interface EmbeddedCheckoutCompleteEvent {\r\n    type: EmbeddedCheckoutEventType.CheckoutComplete;\r\n}\r\n\r\nexport interface EmbeddedCheckoutErrorEvent {\r\n    type: EmbeddedCheckoutEventType.CheckoutError;\r\n    payload: EmbeddedCheckoutError;\r\n}\r\n\r\nexport interface EmbeddedCheckoutLoadedEvent {\r\n    type: EmbeddedCheckoutEventType.CheckoutLoaded;\r\n}\r\n\r\nexport interface EmbeddedCheckoutFrameErrorEvent {\r\n    type: EmbeddedCheckoutEventType.FrameError;\r\n    payload: EmbeddedCheckoutError;\r\n}\r\n\r\nexport interface EmbeddedCheckoutFrameLoadedEvent {\r\n    type: EmbeddedCheckoutEventType.FrameLoaded;\r\n    payload?: EmbeddedContentOptions;\r\n}\r\n\r\nexport interface EmbeddedCheckoutSignedOutEvent {\r\n    type: EmbeddedCheckoutEventType.SignedOut;\r\n}\r\n","import { Response } from '@bigcommerce/request-sender';\r\n\r\nimport StandardError from './standard-error';\r\n\r\nconst DEFAULT_RESPONSE = {\r\n    body: {},\r\n    headers: {},\r\n    status: 0,\r\n};\r\n\r\n/**\r\n * Throw this error if we are unable to make a request to the server. It wraps\r\n * any server response into a JS error object.\r\n */\r\nexport default class RequestError<TBody = any> extends StandardError {\r\n    body: TBody | {};\r\n    headers: { [key: string]: any };\r\n    errors: Array<{ code: string; message?: string }>;\r\n    status: number;\r\n\r\n    constructor(\r\n        response?: Response<TBody | {}>,\r\n        { message, errors }: {\r\n            message?: string;\r\n            errors?: Array<{ code: string; message?: string }>;\r\n        } = {}\r\n    ) {\r\n        const { body, headers, status } = response || DEFAULT_RESPONSE;\r\n\r\n        super(message || 'An unexpected error has occurred.');\r\n\r\n        this.name = 'RequestError';\r\n        this.type = 'request';\r\n        this.body = body;\r\n        this.headers = headers;\r\n        this.status = status;\r\n        this.errors = errors || [];\r\n    }\r\n}\r\n","module.exports = require(\"@bigcommerce/request-sender\");","import StandardError from './standard-error';\r\n\r\n/**\r\n * This error should be thrown when a method is unable to proceed because the\r\n * caller has not provided all the arguments according to their requirements,\r\n * i.e.: if an argument is missing or it is not the expected data type.\r\n */\r\nexport default class InvalidArgumentError extends StandardError {\r\n    constructor(message?: string) {\r\n        super(message || 'Invalid arguments have been provided.');\r\n\r\n        this.name = 'InvalidArgumentError';\r\n        this.type = 'invalid_argument';\r\n    }\r\n}\r\n","import { InvalidArgumentError } from '../error/errors';\r\n\r\nimport Url from './url';\r\n\r\nexport default function parseUrl(url: string): Url {\r\n    if (!/^(https?:)?\\/\\//.test(url)) {\r\n        throw new InvalidArgumentError('The provided URL must be absolute.');\r\n    }\r\n\r\n    // new URL() is not supported in IE11, use anchor tag instead\r\n    const anchor = document.createElement('a');\r\n\r\n    anchor.href = url;\r\n\r\n    // IE11 returns 80 or 443 for the port number depending on the URL scheme,\r\n    // even if the port number is not specified in the URL.\r\n    const port = anchor.port && url.indexOf(`${anchor.hostname}:${anchor.port}`) !== -1 ?\r\n        anchor.port :\r\n        '';\r\n\r\n    return {\r\n        hash: anchor.hash,\r\n        hostname: anchor.hostname,\r\n        href: anchor.href,\r\n        origin: `${anchor.protocol}//${anchor.hostname}${port ? ':' + port : ''}`,\r\n        pathname: anchor.pathname,\r\n        port,\r\n        protocol: anchor.protocol,\r\n        search: anchor.search,\r\n    };\r\n}\r\n","module.exports = require(\"rxjs/operators\");","import IframeEvent from './iframe-event';\r\n\r\nexport default function isIframeEvent<TEvent extends IframeEvent<TType>, TType extends string>(\r\n    object: any,\r\n    type: TType\r\n): object is TEvent {\r\n    return object.type === type;\r\n}\r\n","module.exports = require(\"local-storage-fallback\");"],"sourceRoot":""}